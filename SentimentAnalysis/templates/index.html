<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Product Sentiment Analysis</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="main-container">
    <div class="content">
        <h1>Amazon Sentiment Analysis</h1>
        <p>Wählen Sie ein Produkt aus und führen Sie eine Sentiment-Analyse durch.</p>

        <!-- CSV Upload -->
        <div class="form-group">
            <label for="csv-upload">CSV-Datei hochladen:</label>
            <div class="upload-container">
                <input type="file" id="csv-upload" name="csv-upload" accept=".csv">
                <span class="info-icon" title="Laden Sie eine CSV-Datei mit Produktnamen und Bewertungen hoch.">ℹ️</span>
            </div>
            <p id="csv-validation-message" style="color: red; display: none;"></p>
        </div>

        <!-- Dropdown -->
        <div class="form-group">
            <label for="product">Produkt auswählen:</label>
            <select id="product" name="product" required>
                <!-- Standardoptionen werden serverseitig geladen -->
                {% for product in products %}
                    <option value="{{ product }}">{{ product }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Button -->
        <form id="analyze-form" action="/analyze" method="POST">
            <input type="hidden" name="product" id="hidden-product">
            <button id="analyze-button" type="submit" class="btn" disabled>Analyse durchführen</button>
        </form>
    </div>
</div>

<script>
    document.getElementById('csv-upload').addEventListener('change', function(event) {
        const file = event.target.files[0];
        const validationMessage = document.getElementById('csv-validation-message');
        const analyzeButton = document.getElementById('analyze-button');
        const dropdown = document.getElementById('product');

        if (file) {
            const formData = new FormData();
            formData.append('file', file);

            // CSV-Validierung via API
            fetch('/upload_csv', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Dropdown aktualisieren
                        dropdown.innerHTML = ''; // Bestehende Optionen entfernen
                        data.products.forEach(product => {
                            const option = document.createElement('option');
                            option.value = product;
                            option.textContent = product;
                            dropdown.appendChild(option);
                        });
                        validationMessage.style.display = 'none';
                        analyzeButton.disabled = false;
                    } else {
                        validationMessage.style.display = 'block';
                        validationMessage.textContent = data.message;
                        analyzeButton.disabled = true;
                    }
                })
                .catch(error => {
                    console.error('Fehler bei der Validierung der CSV:', error);
                    validationMessage.style.display = 'block';
                    validationMessage.textContent = 'Fehler beim Hochladen der Datei. Überprüfen Sie die Spaltennamen Ihrer CSV.';
                    analyzeButton.disabled = true;
                });
        }
    });

    document.getElementById('analyze-form').addEventListener('submit', function(event) {
        const selectedProduct = document.getElementById('product').value;

        if (!selectedProduct) {
            event.preventDefault(); // Verhindere das Absenden des Formulars
            alert('Bitte wählen Sie ein Produkt aus!');
            return;
        }

        document.getElementById('hidden-product').value = selectedProduct;
    });
</script>



</body>
</html>
